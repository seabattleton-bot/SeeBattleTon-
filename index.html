<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Морской бой</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { text-align: center; background: #0a1f44; color: white; font-family: Arial; }
        .board { display: grid; grid-template-columns: repeat(10, 1fr); gap: 2px; width: 300px; margin: 20px auto; }
        .cell { aspect-ratio: 1; background: #2a6f9c; border: 1px solid #4ec0e9; cursor: pointer; }
        .hit { background: #ff4444; }
        .miss { background: #87CEEB; }
        .ship { background: #4a4a4a; }
        button { padding: 10px 20px; background: #4ec0e9; border: none; border-radius: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h2>⚓ МОРСКОЙ БОЙ ⚓</h2>
    <div id="status">Твой ход</div>
    <div class="board" id="enemyBoard"></div>
    <div class="board" id="playerBoard"></div>
    <button onclick="newGame()">Новая игра</button>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        let playerShips = [[0,1,2,3],[10,11,12],[20,21,22],[30,31],[40,41],[50,51],[60],[70],[80],[90]];
        let enemyShips = [[5,6,7,8],[15,16,17],[25,26,27],[35,36],[45,46],[55,56],[65],[75],[85],[95]];

        let playerHits = new Array(100).fill(null);
        let enemyHits = new Array(100).fill(null);
        let playerTurn = true;
        let gameOver = false;

        function render() {
            let playerHtml = '', enemyHtml = '';

            for (let i = 0; i < 100; i++) {
                let isPlayerShip = playerShips.some(s => s.includes(i));
                playerHtml += `<div class="cell ${isPlayerShip ? 'ship' : ''} ${enemyHits[i] === 'hit' ? 'hit' : ''} ${enemyHits[i] === 'miss' ? 'miss' : ''}"></div>`;

                let canShoot = playerTurn && !gameOver && !playerHits[i];
                enemyHtml += `<div class="cell ${playerHits[i] === 'hit' ? 'hit' : ''} ${playerHits[i] === 'miss' ? 'miss' : ''}" onclick="${canShoot ? `shoot(${i})` : ''}"></div>`;
            }

            document.getElementById('playerBoard').innerHTML = playerHtml;
            document.getElementById('enemyBoard').innerHTML = enemyHtml;
        }

        function shoot(i) {
            if (!playerTurn || gameOver || playerHits[i]) return;

            let hit = enemyShips.some(s => s.includes(i));
            playerHits[i] = hit ? 'hit' : 'miss';
            render();

            if (enemyShips.every(s => s.every(c => playerHits[c] === 'hit'))) {
                gameOver = true;
                document.getElementById('status').innerText = 'Ты выиграл!';
                return;
            }

            playerTurn = false;
            document.getElementById('status').innerText = 'Ход врага...';
            setTimeout(enemyMove, 500);
        }

        function enemyMove() {
            if (gameOver) return;

            let available = [];
            for (let i = 0; i < 100; i++) if (!enemyHits[i]) available.push(i);
            let i = available[Math.floor(Math.random() * available.length)];

            let hit = playerShips.some(s => s.includes(i));
            enemyHits[i] = hit ? 'hit' : 'miss';
            render();

            if (playerShips.every(s => s.every(c => enemyHits[c] === 'hit'))) {
                gameOver = true;
                document.getElementById('status').innerText = 'Ты проиграл...';
                return;
            }

            playerTurn = true;
            document.getElementById('status').innerText = 'Твой ход';
        }

        function newGame() {
            playerHits = new Array(100).fill(null);
            enemyHits = new Array(100).fill(null);
            playerTurn = true;
            gameOver = false;
            document.getElementById('status').innerText = 'Твой ход';
            render();
        }

        render();
    </script>
</body>
</html>
