<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ú–æ—Ä—Å–∫–æ–π –ë–æ–π –¥–ª—è Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: var(--tg-theme-bg-color, #1a1a2e);
            color: var(--tg-theme-text-color, white);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            font-size: 24px;
            margin: 10px 0;
            color: #4ec0e9;
            text-shadow: 0 0 10px rgba(78, 192, 233, 0.5);
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .board-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        
        .board {
            background: #0f4c81;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .board h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: #ffd700;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            width: min(300px, 90vw);
            aspect-ratio: 1;
        }
        
        .cell {
            background: #2a6f9c;
            border: 1px solid #4ec0e9;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
        }
        
        .cell.enemy:hover {
            background: #ff6b6b;
            transform: scale(0.95);
        }
        
        .cell.ship {
            background: #4a4a4a;
            border-color: #888;
        }
        
        .cell.hit {
            background: #ff4444;
            border-color: #ff0000;
            animation: boom 0.3s;
        }
        
        .cell.miss {
            background: #87CEEB;
            border-color: #4682B4;
        }
        
        .cell.miss::after {
            content: "‚Ä¢";
            color: #333;
            font-size: 24px;
        }
        
        @keyframes boom {
            0% { transform: scale(1); background: white; }
            50% { transform: scale(1.2); background: #ffaa00; }
            100% { transform: scale(1); background: #ff4444; }
        }
        
        .status {
            background: #16213e;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 18px;
            border: 1px solid #4ec0e9;
        }
        
        .ships-left {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .ship-icon {
            width: 30px;
            height: 30px;
            background: #4a4a4a;
            border: 2px solid #888;
            border-radius: 5px;
            position: relative;
        }
        
        .ship-icon.destroyed {
            background: #ff4444;
            border-color: #ff0000;
            opacity: 0.5;
        }
        
        button {
            background: var(--tg-theme-button-color, #4ec0e9);
            color: var(--tg-theme-button-text-color, white);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            box-shadow: 0 4px 0 #2a6f9c;
            transition: 0.1s;
        }
        
        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        
        .coordinates {
            font-size: 14px;
            color: #aaa;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>‚öì –ú–û–†–°–ö–û–ô –ë–û–ô ‚öì</h1>
    
    <div class="game-container">
        <div class="status" id="statusText">
            üéØ –¢–≤–æ–π —Ö–æ–¥! –í—ã–±–µ—Ä–∏ –∫–ª–µ—Ç–∫—É
        </div>
        
        <div class="board-container">
            <!-- –ü–æ–ª–µ –∏–≥—Ä–æ–∫–∞ -->
            <div class="board">
                <h2>–¢–≤–æ–π —Ñ–ª–æ—Ç</h2>
                <div class="grid" id="playerBoard"></div>
            </div>
            
            <!-- –ü–æ–ª–µ –≤—Ä–∞–≥–∞ -->
            <div class="board">
                <h2>–í—Ä–∞–≥</h2>
                <div class="grid" id="enemyBoard"></div>
            </div>
        </div>
        
        <div class="ships-left" id="shipsCount">
            <div class="ship-icon" id="ship4"></div>
            <div class="ship-icon" id="ship3_1"></div>
            <div class="ship-icon" id="ship3_2"></div>
            <div class="ship-icon" id="ship2_1"></div>
            <div class="ship-icon" id="ship2_2"></div>
            <div class="ship-icon" id="ship2_3"></div>
            <div class="ship-icon" id="ship1_1"></div>
            <div class="ship-icon" id="ship1_2"></div>
            <div class="ship-icon" id="ship1_3"></div>
            <div class="ship-icon" id="ship1_4"></div>
        </div>
        
        <button onclick="newGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        let playerBoard, enemyBoard;
        let playerShips, enemyShips;
        let playerHits, enemyHits;
        let gameOver = false;
        let playerTurn = true;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            playerShips = [];
            enemyShips = [];
            playerHits = new Array(100).fill(null);
            enemyHits = new Array(100).fill(null);
            
            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –∫–æ—Ä–∞–±–ª–∏ –∏–≥—Ä–æ–∫–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
            playerShips = [
                [0,1,2,3], // 4-–ø–∞–ª—É–±–Ω—ã–π
                [10,11,12], // 3-–ø–∞–ª—É–±–Ω—ã–π
                [20,21,22], // 3-–ø–∞–ª—É–±–Ω—ã–π
                [30,31], // 2-–ø–∞–ª—É–±–Ω—ã–π
                [40,41], // 2-–ø–∞–ª—É–±–Ω—ã–π
                [50,51], // 2-–ø–∞–ª—É–±–Ω—ã–π
                [60], // 1-–ø–∞–ª—É–±–Ω—ã–π
                [70], // 1-–ø–∞–ª—É–±–Ω—ã–π
                [80], // 1-–ø–∞–ª—É–±–Ω—ã–π
                [90]  // 1-–ø–∞–ª—É–±–Ω—ã–π
            ];
            
            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –∫–æ—Ä–∞–±–ª–∏ –≤—Ä–∞–≥–∞ (—Å–ª—É—á–∞–π–Ω–æ)
            enemyShips = generateEnemyShips();
            
            renderBoards();
            updateStatus();
            updateShipsIcons();
        }
        
        function generateEnemyShips() {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –¥–µ–º–æ
            return [
                [5,6,7,8],
                [15,16,17],
                [25,26,27],
                [35,36],
                [45,46],
                [55,56],
                [65],
                [75],
                [85],
                [95]
            ];
        }
        
        function renderBoards() {
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            let playerHtml = '';
            for (let i = 0; i < 100; i++) {
                let cellClass = 'cell';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –∫–æ—Ä–∞–±–ª—å –∏–≥—Ä–æ–∫–∞
                let isShip = playerShips.some(ship => ship.includes(i));
                
                if (isShip) cellClass += ' ship';
                if (enemyHits[i] === 'hit') cellClass += ' hit';
                if (enemyHits[i] === 'miss') cellClass += ' miss';
                
                playerHtml += `<div class="${cellClass}" data-index="${i}"></div>`;
            }
            document.getElementById('playerBoard').innerHTML = playerHtml;
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è –≤—Ä–∞–≥–∞
            let enemyHtml = '';
            for (let i = 0; i < 100; i++) {
                let cellClass = 'cell enemy';
                if (playerHits[i] === 'hit') cellClass += ' hit';
                if (playerHits[i] === 'miss') cellClass += ' miss';
                
                enemyHtml += `<div class="${cellClass}" data-index="${i}" onclick="playerMove(${i})"></div>`;
            }
            document.getElementById('enemyBoard').innerHTML = enemyHtml;
        }
        
        function playerMove(index) {
            if (!playerTurn || gameOver || playerHits[index]) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –∫–æ—Ä–∞–±–ª—å –≤—Ä–∞–≥–∞
            let hit = false;
            let shipIndex = -1;
            
            for (let i = 0; i < enemyShips.length; i++) {
                if (enemyShips[i].includes(index)) {
                    hit = true;
                    shipIndex = i;
                    break;
                }
            }
            
            if (hit) {
                playerHits[index] = 'hit';
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–±–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å
                let ship = enemyShips[shipIndex];
                let allHit = ship.every(cell => playerHits[cell] === 'hit');
                
                if (allHit) {
                    // –û—Ç–º–µ—á–∞–µ–º –∫–ª–µ—Ç–∫–∏ –≤–æ–∫—Ä—É–≥ —É–±–∏—Ç–æ–≥–æ –∫–æ—Ä–∞–±–ª—è
                    ship.forEach(cell => {
                        markAround(cell, playerHits, 'miss');
                    });
                    
                    // –£–±–∏—Ä–∞–µ–º –∫–æ—Ä–∞–±–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞
                    enemyShips.splice(shipIndex, 1);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                    if (enemyShips.length === 0) {
                        gameOver = true;
                        document.getElementById('statusText').innerHTML = 'üèÜ –¢–´ –ü–û–ë–ï–î–ò–õ! üèÜ';
                        return;
                    }
                }
                
                renderBoards();
                updateShipsIcons();
            } else {
                playerHits[index] = 'miss';
                renderBoards();
                playerTurn = false;
                document.getElementById('statusText').innerHTML = 'ü§ñ –•–æ–¥ –≤—Ä–∞–≥–∞...';
                
                // –•–æ–¥ –≤—Ä–∞–≥–∞
                setTimeout(enemyMove, 500);
            }
        }
        
        function enemyMove() {
            if (gameOver) return;
            
            // –ü—Ä–æ—Å—Ç–æ–π AI - —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª
            let available = [];
            for (let i = 0; i < 100; i++) {
                if (!enemyHits[i]) available.push(i);
            }
            
            if (available.length > 0) {
                let index = available[Math.floor(Math.random() * available.length)];
                let hit = false;
                let shipIndex = -1;
                
                for (let i = 0; i < playerShips.length; i++) {
                    if (playerShips[i].includes(index)) {
                        hit = true;
                        shipIndex = i;
                        break;
                    }
                }
                
                if (hit) {
                    enemyHits[index] = 'hit';
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–±–∏—Ç –ª–∏ –∫–æ—Ä–∞–±–ª—å –∏–≥—Ä–æ–∫–∞
                    let ship = playerShips[shipIndex];
                    let allHit = ship.every(cell => enemyHits[cell] === 'hit');
                    
                    if (allHit) {
                        ship.forEach(cell => {
                            markAround(cell, enemyHits, 'miss');
                        });
                        playerShips.splice(shipIndex, 1);
                        
                        if (playerShips.length === 0) {
                            gameOver = true;
                            renderBoards();
                            document.getElementById('statusText').innerHTML = 'üíî –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª...';
                            return;
                        }
                    }
                } else {
                    enemyHits[index] = 'miss';
                }
                
                renderBoards();
                updateShipsIcons();
            }
            
            playerTurn = true;
            document.getElementById('statusText').innerHTML = 'üéØ –¢–≤–æ–π —Ö–æ–¥!';
        }
        
        function markAround(index, hitsArray, value) {
            let x = index % 10;
            let y = Math.floor(index / 10);
            
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    let nx = x + dx;
                    let ny = y + dy;
                    if (nx >= 0 && nx < 10 && ny >= 0 && ny < 10) {
                        let i = ny * 10 + nx;
                        if (!hitsArray[i]) {
                            hitsArray[i] = value;
                        }
                    }
                }
            }
        }
        
        function updateShipsIcons() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –∫–æ—Ä–∞–±–ª–µ–π
            for (let i = 0; i < 10; i++) {
                let icon = document.getElementById(`ship${i+1}`);
                if (icon) {
                    if (i < playerShips.length) {
                        icon.className = 'ship-icon';
                    } else {
                        icon.className = 'ship-icon destroyed';
                    }
                }
            }
        }
        
        function updateStatus() {
            let playerCount = playerShips.length;
            let enemyCount = enemyShips.length;
            document.getElementById('statusText').innerHTML = 
                `üéØ –¢–≤–æ–π —Ö–æ–¥! –û—Å—Ç–∞–ª–æ—Å—å: —É —Ç–µ–±—è ${playerCount}, —É –≤—Ä–∞–≥–∞ ${enemyCount}`;
        }
        
        function newGame() {
            initGame();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
        initGame();
    </script>
</body>
  </html>
