<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Морской бой</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { text-align: center; background: #0a1f44; color: white; font-family: Arial; }
        .board { display: grid; grid-template-columns: repeat(10, 1fr); gap: 2px; width: 300px; margin: 20px auto; }
        .cell { aspect-ratio: 1; background: #2a6f9c; border: 1px solid #4ec0e9; cursor: pointer; }
        .hit { background: #ff4444; }
        .miss { background: #87CEEB; }
        .ship { background: #4a4a4a; }
        button { padding: 10px 20px; background: #4ec0e9; border: none; border-radius: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h2>⚓ МОРСКОЙ БОЙ ⚓</h2>
    <div id="status">Твой ход</div>
    <div class="board" id="enemyBoard"></div>
    <div class="board" id="playerBoard"></div>
    <button onclick="newGame()">Новая игра</button>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        // Корабли
        let playerShips = [[0,1,2,3],[10,11,12],[20,21,22],[30,31],[40,41],[50,51],[60],[70],[80],[90]];
        let enemyShips = [[5,6,7,8],[15,16,17],[25,26,27],[35,36],[45,46],[55,56],[65],[75],[85],[95]];

        let playerHits = new Array(100).fill(null); // выстрелы игрока по врагу
        let enemyHits = new Array(100).fill(null);  // выстрелы врага по игроку
        let playerTurn = true;
        let gameOver = false;

        function render() {
            let playerHtml = '';
            let enemyHtml = '';

            for (let i = 0; i < 100; i++) {
                // Своё поле (игрок)
                let isPlayerShip = false;
                for (let s of playerShips) if (s.includes(i)) isPlayerShip = true;
                playerHtml += `<div class="cell ${isPlayerShip ? 'ship' : ''} ${enemyHits[i] === 'hit' ? 'hit' : ''} ${enemyHits[i] === 'miss' ? 'miss' : ''}"></div>`;

                // Поле врага
                let enemyClass = 'cell';
                if (playerHits[i] === 'hit') enemyClass += ' hit';
                else if (playerHits[i] === 'miss') enemyClass += ' miss';

                let canShoot = playerTurn && !gameOver && !playerHits[i];
                enemyHtml += `<div class="${enemyClass}" onclick="${canShoot ? `shoot(${i})` : ''}"></div>`;
            }

            document.getElementById('playerBoard').innerHTML = playerHtml;
            document.getElementById('enemyBoard').innerHTML = enemyHtml;
        }

        
        function enemyMove() {
    if (gameOver) return;

    let available = [];
    for (let i = 0; i < 100; i++) {
        if (!enemyHits[i]) available.push(i);
    }
    if (available.length === 0) return;

    let index = available[Math.floor(Math.random() * available.length)];

    let hit = false;
    for (let ship of playerShips) {
        if (ship.includes(index)) {
            hit = true;
            break;
        }
    }
function shoot(index) {
    if (!playerTurn || gameOver || playerHits[index]) return;

    let hit = false;
    for (let ship of enemyShips) {
        if (ship.includes(index)) {
            hit = true;
            break;
        }
    }

    playerHits[index] = hit ? 'hit' : 'miss';
    render();

    let allDestroyed = true;
    for (let ship of enemyShips) {
        for (let cell of ship) {
            if (playerHits[cell] !== 'hit') {
                allDestroyed = false;
                break;
            }
        }
    }

    if (allDestroyed) {
        gameOver = true;
        document.getElementById('status').innerText = 'Ты выиграл!';
        return;
    }

    playerTurn = false;
    document.getElementById('status').innerText = 'Ход врага...';
    setTimeout(enemyMove, 500);
        }
    enemyHits[index] = hit ? 'hit' : 'miss';
    render();

    // Проверка, все ли корабли игрока убиты
    let allDestroyed = true;
    for (let ship of playerShips) {
        for (let cell of ship) {
            if (enemyHits[cell] !== 'hit') {
                allDestroyed = false;
                break;
            }
        }
    }

    if (allDestroyed) {
        gameOver = true;
        document.getElementById('status').innerText = 'Ты проиграл...';
        return;
    }

    playerTurn = true;
    document.getElementById('status').innerText = 'Твой ход';
}

        render();
    </script>
</body>
</html>
